pipeline:
  lint:
    image: kecorbin/ansible
    commands:
      - . activate.sh
      - make test
  build:
    when:
        branch: test
    image: kecorbin/ansible
    environment:
      - ANSIBLE_NET_USERNAME=cisco
      - ANSIBLE_NET_PASSWORD=cisco
      - ANSIBLE_NET_AUTH=True
      - ANSIBLE_NET_AUTH_PASS=cisco
    commands:
      - env
      - ./deploy.sh --env test

  build:
    when:
        branch: master
    image: kecorbin/ansible
    environment:
      - ANSIBLE_NET_USERNAME=cisco
      - ANSIBLE_NET_PASSWORD=cisco
      - ANSIBLE_NET_AUTH=True
      - ANSIBLE_NET_AUTH_PASS=cisco
    commands:
      - env
      - ./deploy.sh --env prod

  notify:
    image: hpreston/drone-spark:0.7
    secrets: [ SPARK_TOKEN, SPARK_ROOM ]
    roomId: ${SPARK_ROOM}
    auth_token: ${SPARK_TOKEN}
